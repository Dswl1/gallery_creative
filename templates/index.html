<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="shortcut icon" href="img/logo.ico" type="image/x-icon">
    <link rel="icon" href="{{ url_for('static', filename='assets/logo.png') }}" type="image/png">
    <title>{% block title %}{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen font-sans text-gray-900"
    style="background: linear-gradient(to bottom, #36d7f3 10%, #ffffff 90%); background-attachment: fixed;">

    {% include 'partials/header.html' %}

    <main>
        {% block content %}
        {% endblock %}
    </main>

    {% include 'partials/footer.html' %}


    <div id="imgModal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50">

        <div class="relative max-w-3xl w-full">
            <img id="modalImg" class="w-full rounded-sm shadow-lg transform scale-95 transition-transform duration-300">
        </div>

        <button id="closeModalBtn" class="absolute top-4 right-4 z-[60] text-white text-2xl hover:text-red-500">
            <i class="fas fa-times"></i>
        </button>
    </div>


    <style>
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeIn {
            animation: fadeIn 1s ease-in-out;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/animations.js') }}"></script>
    <script>
        const searchInput = document.getElementById('searchInput');
        const sortSelect = document.getElementById('sortSelect');
        const contentGrid = document.getElementById('contentGrid');

        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const pageInfo = document.getElementById('pageInfo');

        let currentPage = 1;
        let totalPages = 1;
        const limit = 12;
        let debounceTimer;

        /* FETCH */
        function fetchContents() {
            const search = searchInput.value;
            const sort = sortSelect.value;

            fetch(`/api/contents?search=${encodeURIComponent(search)}&sort=${sort}&page=${currentPage}&limit=${limit}`)
                .then(res => res.json())
                .then(data => {
                    renderContents(data.items);

                    totalPages = Math.ceil(data.total / limit);
                    pageInfo.textContent = `Page ${currentPage} / ${totalPages}`;

                    prevBtn.disabled = currentPage === 1;
                    nextBtn.disabled = currentPage === totalPages;
                });
        }

        /* RENDER */
        function renderContents(data) {
            contentGrid.innerHTML = '';

            if (data.length === 0) {
                contentGrid.innerHTML = `
            <div class="col-span-full text-center text-gray-500">
                Tidak ada karya ditemukan
            </div>
        `;
                return;
            }

            data.forEach(img => {
                contentGrid.innerHTML += `
        <a href="/detail/${img.id}" class="group relative block overflow-hidden rounded-2xl
            bg-white shadow-lg hover:shadow-2xl
            transition-all duration-500 hover:-translate-y-2 cursor-pointer">

            <div class="overflow-hidden">
                <img src="/static/uploads/${img.filename}" class="w-full h-56 object-cover
                     transition-transform duration-700 group-hover:scale-110" alt="${img.title}">
            </div>

            <div class="absolute inset-0 bg-gradient-to-t
                from-black/70 via-black/20 to-transparent
                opacity-0 group-hover:opacity-100
                transition-opacity duration-500 pointer-events-none">

                <div class="absolute bottom-0 w-full px-4 py-4">
                    <h3 class="text-white font-semibold text-sm md:text-base">${img.title}</h3>
                    <p class="text-xs text-gray-300">${img.username}</p>
                </div>

            </div>
        </a>
        `;
            });
        }

        /* EVENTS */
        function scrollToContent() {
            document.getElementById('content').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }

        prevBtn.onclick = () => {
            if (currentPage > 1) {
                currentPage--;
                fetchContents();
                scrollToContent();
            }
        };

        nextBtn.onclick = () => {
            if (currentPage < totalPages) {
                currentPage++;
                fetchContents();
                scrollToContent();
            }
        };


        searchInput.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                currentPage = 1;
                fetchContents();
            }, 300);
        });

        sortSelect.addEventListener('change', () => {
            currentPage = 1;
            fetchContents();
        });

        /* LOAD AWAL */
        fetchContents();
    </script>
</body>

</html>